.destination_filter_import_item.pull-right
  = form_tag import_items_path, method: :get do |f|
    = label_tag 'List Destination '
    = select_tag 'destination_item', options_for_select( ["Kampala", "Kigali", "Lusaka", "Goma"], params[:destination_item] || 'Kampala')

#statusModal.modal.fade{"aria-labelledby" => "myModalLabel", :role => "dialog", :tabindex => "-1"}
  .modal-dialog
#infoModal.modal.fade{"aria-labelledby" => "myModalLabel", :role => "dialog", :tabindex => "-1"}
  .modal-dialog

%table.table{id: 'import_items_table'}
  %thead
    - if is_rfs_host?
      %th.import-items-cust-name Customer Name / Shipper Name / Consignee Name
    - else
      %th.import-items-cust-name Customer Name
    %th.import-items-bl-number BL # / File Ref #
    %th.import-items-cont-number Container Number
    %th.import-items-eq Display EQ
    %th.import-items-eta Estimate Arrival
    - if is_rfs_host? || is_ug_host? || Rails.env.development?
      %th.import-items-truck-number Truck Number / Location
    %th.import-items-last-load-date Last Loading Date
    %th.shipping-line-status DO Received?
    %th.import-items-status Status
    %th.import-items-remarks Remarks
  %tbody
    - @import_items.each do |item|
      - import = item.import
      %tr{id: item.id}
        - if is_rfs_host?
          %td= "#{item.customer_name}" + " / " + "#{item.import.shipper}" + "/#{item.import.consignee_name}"
        - else
          %td= item.customer_name
        %td= "#{item.import.bl_number} / #{item.import.work_order_number}"
        %td= item.container_number
        %td= item.equipment
        %td= item.import.estimate_arrival
        - if is_rfs_host? || is_ug_host? || Rails.env.development?
          %td.truck_id
            - if item.truck.present?
              - truck = (item.truck_id == 0 ? item.truck_number : item.truck.reg_number)
              - location =  item.truck.location
              = link_to "#{truck} / #{location}", location_dates_modal_import_item_path(item), remote: true
            - elsif item.next_truck_id.present?
              - next_truck = Truck.find(item.next_truck_id)
              = "Next :"
              %b #{next_truck.reg_number}
              = "/ #{next_truck.location}" if next_truck.location.present?
        %td.last_loading_date= item.last_loading_date.nil? ? '' : item.last_loading_date.strftime('%Y-%m-%d')
        %td.shipping-status
          = link_to "#{import.do_received_at.present? ? 'Yes' : 'No'}", show_info_import_item_path(item), remote: true, class: 'btn btn-link'
        %td.updatestatus{class: "text-center"}
          .updatestatus.h5
            .status_updated_at
              = item.try(:status_date).try(:send, item.status.to_sym).nil? ? status_updated_at(item).to_date : item.status_date.send(item.status.to_sym).to_date
            .status.text.capatilize
              = item.status.titleize
          = link_to 'Update', edit_import_item_path(item), remote: true, :data => { states: item.status + ',' + item.aasm.events.join(',') },
            class: 'btn btn-small btn-primary'
        %td.remarks.h5
          .desc
            = item.remarks.order(id: :asc).last.try(:desc)
          %button.btn.btn-small.btn-primary{'data-model-id' => "#{item.id}", 'data-model-type' => 'import_item', 'data-target' => '#remarkModal', 'data-toggle' => 'modal'} Add

= render 'remarks/remark'
#ShowLocationDatesModal

:css
  .truck_id {
    width: 110px;
  }

:coffeescript
  import_items = #{@import_item.to_json}

  $('#statusModal1').on 'show.bs.modal', (event) ->
    $('#import_item_truck_id').select2('val', '')
    $('#import_item_truck_id').find('option').remove().end()

    link_tag = $(event.relatedTarget)
    id = link_tag.attr('data-importitem-id')

    truck = import_items.filter((t) -> t.id == parseInt(id))[0]
    if truck && truck.truck_id
      $('#import_item_truck_id').append("<option value=" + truck.truck_id + ">" + truck['truck_number'] + "</option>")
      $('#import_item_truck_id').val(truck.truck_id).trigger('change')

    #$.get('/trucks/load_truck_numbers', {truck_id: truck.id}).done (data) ->
    #  $.each data, (index, value) ->
    #    $('#import_item_truck_id').append $('<option>', value: value[1], text: value[0])

    $("#import_items_table tr#"+ id + " td.updatestatus .updatestatus").hide()
    $('#statusModal form #import_item_status').html("")
    for i in link_tag.attr('data-states').split(",")
      $('#statusModal form #import_item_status').append("<option value=" + i + ">" + i.replace(/_/g, ' ') + "</option>")

    $('#statusModal form').attr('action', "/import_items/" + id + "/updateStatus")

  $('#statusModal1').on 'hide.bs.modal', (event) ->
    $("#import_items_table tr td.updatestatus .updatestatus").show()
