%table.table.table-hover.table-bordered#payment_details_table
  %h4.col-sm-3= @header.name
  %div.col-sm-1.mt-10
    = label_tag "Date Range"
  %div.col-sm-2
    = text_field_tag :filter_by_date_select,date_filter_parameters(controller_name), as: :string, class:"form-control"
  %div.col-sm-3
    = link_to 'Readjust Payments', readjust_customer_path(@header.id), class: 'readjust_tooltip', :data => {:toggle => 'tooltip' }, 
      'data-placement' => 'down', 'title' => " Readjust if you delete any invoice or Payments"
  %div.col-sm-3
    %a.glyphicon.glyphicon-download-alt{href: "#{received_path(@header.id)}"}
      %span.download Download Ledger
  %tr.info
    %th Date
    %th Type
    %th Reference / Invoice No.
    %th Bill of Lading
    %th Amount (USD)
    %th Received (USD)
    - if can? :new, Received
      %th Action

  %tbody#payment_search_result
    %script#payment_search_result_template{:type => "text/html"}
      %tr
        %td <%= date %>
        %td.voucher_type <%= voucher_type %>
        %td <%= invoice_number %>
        %td <%= bl_number %>
        %td.amount <%= amount %>
        %td.received <%= received %>
        - if can? :delete_ledger, [Received, Invoice]
          <td> <a href= delete/<%=  delete_invoice_or_payment %> data-confirm="This will readjust Payments again" data-method="delete" > Delete <a></td>

:javascript
  payments = #{@payments}
  if (payments != 0) {
    var all_time_payments = payments
    PaymentFilterInit();
  }
  $('.readjust_tooltip').tooltip();
  $(document).ready(function(){
    var custom_label = ""
    var last_year = new Date().getFullYear()-1
    var next_year = new Date().getFullYear()+1
    var current_year = new Date().getFullYear()

    $("#filter_by_date_select").daterangepicker({
    locale: { format: 'YYYY-MM-DD',
              separator: ','},
    cancelLabel: 'Clear',
    ranges:{
      "All Time":#{get_date_range(controller_name)},
      "Current FY":[new Date(current_year,06,01), new Date(next_year,05,30)],
      "Last FY":[new Date(last_year,06,01), new Date(current_year,05,30)]
    }
    },
    function(start, end, label) {
      custom_label = label
    })
    $("#filter_by_date_select").val("All Time")
    $("#filter_by_date_select").on("apply.daterangepicker",function(){
      if(custom_label != 'Custom Range'){
        $(this).val(custom_label)
      }
    })
  })
  